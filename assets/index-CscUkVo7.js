(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function s(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(n){if(n.ep)return;n.ep=!0;const r=s(n);fetch(n.href,r)}})();const l={canvasWidth:1080,canvasHeight:1350,gridSize:1024,get margin(){return(this.canvasWidth-this.gridSize)/2},maxStates:32,transparentFraction:[.5,1.5],layerCount:[5,9],baseModRange:[1,10],bandSizeRange:[1,10],offsetRange:[0,256],noiseAmplitude:8,textFont:'"Courier New", monospace',textSize:24,textWeight:"bold"};function O(t,e){return e===0?t:O(e,t%e)}function B(t,e){const s=O(Math.abs(t),Math.abs(e)),o=[];for(let n=1;n*n<=s;n++)s%n===0&&(o.push(n),n!==s/n&&o.push(s/n));return o.sort((n,r)=>n-r)}function f(t,e){t>e&&([t,e]=[e,t]);const s=Math.ceil(t),o=Math.floor(e);return Math.floor(Math.random()*(o-s+1))+s}function N(t,e){return t>e&&([t,e]=[e,t]),Math.random()*(e-t)+t}function C(t){let e=t[0],s=t[0],o=1/0,n=-1/0;for(const r of t){const a=r.replace(/^#/,""),d=parseInt(a,16),m=d>>16&255,h=d>>8&255,c=d&255,u=.2126*m+.7152*h+.0722*c;u<o&&(o=u,e=r),u>n&&(n=u,s=r)}return{darkest:e,lightest:s}}const P=(t,e)=>String(t).padStart(e,"0");function E(t,e,s){const o=`${year()}${P(month(),2)}${P(day(),2)}_${P(hour(),2)}${P(minute(),2)}${P(second(),2)}`;saveCanvas(`${o}_${t}s_${e}t_${s}`,"png")}const I={drawBitGrid:({cols:t,rows:e,xOffset:s,yOffset:o,patternFn:n,palette:r,width:a,height:d,numTransparentStates:m},h=null)=>{const c=h||window;c.loadPixels();const u=a/t,S=d/e;for(let i=0;i<d;i++){const p=Math.floor(i/S);for(let g=0;g<a;g++){const y=Math.floor(g/u),$=n(y+s,p+o),x=4*(g+i*a),v=$-m;if(v<0||v>=r.length)c.pixels[x+3]=0;else{const z=r[v].replace(/^#/,""),M=parseInt(z,16);c.pixels[x+0]=M>>16&255,c.pixels[x+1]=M>>8&255,c.pixels[x+2]=M&255,c.pixels[x+3]=255}}}c.updatePixels()},drawLayers:(t,e,s=0)=>{t.forEach(o=>{const n=createGraphics(e,e);I.drawBitGrid({...o,width:e,height:e,numTransparentStates:o.numTransparentStates},n),image(n,s,s)})}},b=[(t,e)=>t&e,(t,e)=>t^e,(t,e)=>t|e];function T(t,e,s){const o=b[f(0,b.length-1)],n=f(...t.baseModRange),r=f(...t.bandSizeRange),a=s[f(1,s.length-2)],d=t.gridSize/a,m=t.gridSize/a,h=f(...t.offsetRange),c=f(...t.offsetRange);return{cols:d,rows:m,xOffset:h,yOffset:c,patternFn:(S,i)=>{const p=Math.floor(i/r),g=n+p;let y=o(S+i,i-S)%g;return y<0&&(y+=g),y%e}}}function _({cfg:t,palette:e,darkest:s,lightest:o,bgCol:n,numStates:r,numTransparentStates:a,totalStates:d,numLayers:m,chosenPalName:h}){const c=n===s?o:n===o?s:[s,o][f(0,1)];fill(`#${c}`),noStroke(),rect(t.margin,t.gridSize+t.margin*2,t.gridSize,t.canvasHeight-t.gridSize-t.margin*3),textSize(t.textSize),textAlign(LEFT,TOP),textLeading(t.margin),textFont(t.textFont),textStyle(t.textWeight),fill(`#${c===s?o:s}`);const u=[`OPS        : ${b}`,`States     : ${a} transparent, ${r} filled, ${d} total`,"Base, Band : ∈ ℤ ∩ [1, 10]",`Layers     : ${m}`,`Palette    : ${h}`],S=t.margin*2,i=t.gridSize+t.margin*3;u.forEach(($,x)=>text($,S,i+x*t.margin,t.gridSize-t.margin*2));const p=Math.round(i+(textAscent()+textDescent()+(u.length-1)*t.margin)+t.margin),g=t.canvasHeight-t.margin-p,y=t.gridSize/e.length;loadPixels(),e.forEach(($,x)=>{const v=parseInt($.replace(/^#/,""),16),z=v>>16&255,M=v>>8&255,R=v&255,W=Math.round(t.margin+x*y),A=Math.round(t.margin+(x+1)*y);for(let L=p;L<p+g;L++){const H=4*L*t.canvasWidth;for(let F=W;F<A;F++){const w=H+4*F;pixels[w]=z,pixels[w+1]=M,pixels[w+2]=R,pixels[w+3]=255}}}),updatePixels()}async function D(){noLoop();const t=await loadJSON("masterPalettes.json");createCanvas(l.canvasWidth,l.canvasHeight),pixelDensity(1);const e=f(2,l.maxStates),s=Math.floor(N(...l.transparentFraction)*e),o=e+s,n=t[e],r=random(n),a=r.colors,{darkest:d,lightest:m}=C(a),h=`${a[f(0,a.length-1)]}`;background(`#${h}`);const c=f(...l.layerCount),u=B(l.gridSize,l.gridSize),S=Array.from({length:c},()=>({...T(l,o,u),palette:a,numTransparentStates:s}));I.drawLayers(S,l.gridSize,l.margin),_({cfg:l,palette:a,darkest:d,lightest:m,bgCol:h,numStates:e,numTransparentStates:s,totalStates:o,numLayers:c,chosenPalName:r.name}),loadPixels();for(let i=0;i<pixels.length;i+=4){const p=f(-l.noiseAmplitude,l.noiseAmplitude);pixels[i]=constrain(pixels[i]+p,0,255),pixels[i+1]=constrain(pixels[i+1]+p,0,255),pixels[i+2]=constrain(pixels[i+2]+p,0,255)}updatePixels(),E(e,s,r.name)}window.setup=D;
